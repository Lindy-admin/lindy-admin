<h1><%= @course.title %></h1>
<p>
  <%= @course.description %>
</p>

<p>
  <strong>Start:</strong>
  <%= @course.start %>
</p>

<p>
  <strong>End:</strong>
  <%= @course.end %>
</p>
<%= link_to 'Edit', edit_course_path(@course), class:"btn btn-primary" %>
<%= link_to 'Destroy', @course, method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-danger" %>

<h2>Tickets</h2>
<table class="table table-striped">
  <thead>
    <tr>
      <th>Label</th>
      <th>Price</th>
      <th colspan="1"></th>
    </tr>
  </thead>

  <tbody>
    <% @course.tickets.each do |ticket| %>
      <tr data-link="<%= edit_course_ticket_path(@course, ticket) %>">
        <td><%= ticket.label %></td>
        <td><%= ticket.price %></td>
        <td><%= link_to 'Remove', [@course, ticket], method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-danger" %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<%= link_to 'Add Ticket', new_course_ticket_path(@course), class: "btn btn-success" %>

<h2>Registrations</h2>
<p>
  <strong>Leads/Follows:</strong>
  <%= "#{@course.leads} / #{@course.follows}" %>
</p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Firstname</th>
      <th>Lastname</th>
      <th>Role</th>
      <th>Ticket</th>
      <th>Payment</th>
      <th colspan="2"></th>
    </tr>
  </thead>

  <tbody>
    <% @course.registrations.each do |registration| %>
    <% member = registration.member %>
      <tr data-link="<%= url_for(member) %>">
        <td><%= member.firstname %></td>
        <td><%= member.lastname %></td>
        <td><%= role_label(registration.role) %></td>
        <td><%= registration.ticket.label %></td>
        <td><%= registration.payment.status %></td>
        <td><%= link_to 'Switch Role', switch_role_path(registration), method: :post, class:"btn btn-primary" %></td>
        <td><%= link_to 'Remove', registration, method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-danger" %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="row">
  <h2>Export</h2>
  <%= link_to 'CSV', members_course_path(@course, format: "csv"), class: "btn btn-info" %>
  <%= link_to 'Excel', members_course_path(@course, format: "xls"), class: "btn btn-success" %>
</div>
